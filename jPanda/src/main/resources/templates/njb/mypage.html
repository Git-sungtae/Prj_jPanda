



<!-- 
	로그인이 안되어 있을시에 로그인이 필요하다는 메세지만 나오고
	로그인시 회원정보나
	로그아웃시 로그인페이지로 이동
	(아직 모든거 안나옴,	수정기능 ,탈퇴기능 아직 안됨)
	


 -->



<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style type="text/css">
    div {
        width: 100%;
        height: 100vh;
        
        border: 1px solid rgb(248, 248, 248);
    }
    div.left {
        width: 30%;
        float: left;
        box-sizing: border-box;
       	font-size: 30px;
        
        background: rgb(196, 196, 191);
    }
    div.right {
        width: 70%;
        float: right;
        box-sizing: border-box;
        font-size: 20px;
        
        background: rgb(250, 252, 252);
    }


.left,right{
    text-align: center;
    width: 460px;
    margin: auto;
}
#logout-btn, #withdrawal-btn, #login-btn{
    width:115px;
    background-color: black;
    border: none;
    color:#fff;
    font-size: 15px;
    outline:none;
    cursor: pointer;
}
/* ahref 밑줄없애기 */
a {
    text-decoration: none;
    color:black;
    
}
ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
}
.left {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.login-out-btn-wrap,
.withdrawal-btn-wrap {
  margin-top: auto;
  margin-bottom: 10px;
}
.login-out-btn-wrap {
    position: absolute;
    top: 0;
    right: 0;
}
</style>

<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
    <h1 align="center">마이페이지</h1>
    	    <span class="login-out-btn-wrap">
	        <button type="button" th:if="${session.memberId == null}" id="login-btn">로그인</button>
	        <button type="button" th:if="${session.memberId != null}" id="logout-btn">로그아웃</button>
	     </span> 
        <div class="left" align="center">
        <img src="/image/basic.png" alt="기본사진">
           <ul>   
              <li>내프로필</li>
              <li>계정설정</li>
              <li>거래내역</li>
           </ul>

	     <span class="withdrawal-btn-wrap" th:if="${session.memberId != null}">
	        <button type="button" id="withdrawal-btn">회원탈퇴</button>
         </span>
        </div>
        
        <div class="right" align="center" th:if="${session.memberId != null}">
		    <h1>내프로필</h1>
		    <h1 th:text="'Welcome, ' + ${session.memberId} + '님!'"></h1>
		    	<ul>
		    		<li th:if="${memberInfo != null}" th:text="'이름 : ' + ${memberInfo.name}"></li>
		    		<li th:if="${memberInfo != null}" th:text="'이메일 : ' + ${memberInfo.email}"></li>
		    		<li th:if="${memberInfo != null}" th:text="'전화번호 : ' + ${memberInfo.tel}"></li>
				</ul>
			        <button type="button" th:if="${session.memberId != null}" id="btn">정보수정</button>
			<div class="menu">
				<span>
					<a href="/" target="_blank">계정설정</a>
				</span>
				<span>
					<a href="/" target="_blank">거래내역</a>
				</span>
			</div>
		</div>
		<div class="right" align="center" th:unless="${session.memberId != null}">
    		<h1>로그인이 필요합니다.</h1>
		</div>
        
<script>
// 로그아웃 버튼 클릭 이벤트 핸들러 등록

$('#logout-btn').click(function() {
  $.ajax({
    url: '/logout', // 로그아웃 요청을 보낼 URL
    type: 'GET', // HTTP 요청 메서드
    dataType: 'text', // 서버 응답 데이터 타입
    success: function(result) {
      alert('로그아웃 되었습니다.');
      location.href='/login';
    },
    error: function(xhr, status, error) {
      alert('로그아웃 실패: ' + error);
    }
  });
});
// 회원탈퇴 버튼 클릭 이벤트 핸들러 등록
  $('#withdrawal-submit').click(function() {
    var password = $('#withdrawal-password').val();
    $.ajax({
      url: '/withdrawal',
      type: 'POST',
      dataType: 'text',
      data: {password: password},
      success: function(result) {
        alert('회원탈퇴 되었습니다.');
        location.href = '/login';
      },
      error: function(xhr, status, error) {
        $('#withdrawal-error').show();
      }
    });
  });
$('#login-btn').click(function() {
	  $.ajax({
	    url: '/login',
	    type: 'GET',
	    success: function(response) {
			location.href='/login';
	    },
	    error: function(jqXHR, textStatus, errorThrown) {
	      console.log('Error: ' + errorThrown);
	    }
	  });
	});
</script> 
</body>

</html>