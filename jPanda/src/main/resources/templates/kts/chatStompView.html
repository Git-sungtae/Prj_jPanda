<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Chat Popup</title>
    <style>
      /* 스크롤 버튼 스타일 */
      #scroll-to-chat {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 60px;
        height: 60px;
        background-color: #4CAF50;
        color: white;
        border-radius: 50%;
        text-align: center;
        font-size: 30px;
        line-height: 60px;
        cursor: pointer;
      }
      
      /* 팝업 채팅창 스타일 */
      #chat-popup {
        display: none;
        position: fixed;
        bottom: 100px;
        right: 50px;
        width: 400px;
        height: 500px;
        background-color: white;
        border: 1px solid #ddd;
      }
      
      /* 채팅 입력창 스타일 */
      #chat-input {
        width: 100%;
        height: 60px;
        padding: 10px;
        border: none;
        border-top: 1px solid #ddd;
        box-sizing: border-box;
        resize: none;
        overflow: auto;
        position: absolute;
        bottom: 0;
        left: 0;
      }
      
      /* 채팅 상대 목록 스타일 */
      #chat-list {
        width: 30%;
        height: 100%;
        float: left;
        box-sizing: border-box;
        border-right: 1px solid #ddd;
        overflow-y: auto;
        padding: 10px;
      }
      
      /* 선택된 채팅 상대 스타일 */
      #selected-chat {
        margin-top: 10px;
        margin-bottom: 10px;
        font-weight: bold;
      }
      
      /* 채팅 대화 내용 스타일 */
      #chat-content {
        width: 70%;
        height: 100%;
        float: left;
        box-sizing: border-box;
        padding: 10px;
        overflow-y: auto;
		max-height: 200px; /* 스크롤이 필요한 최대 높이 */
		overflow-y: auto; /* 스크롤을 표시하고 내용이 넘칠 경우 스크롤을 사용할 수 있게 함 */
      }
      #chat-popup {
		  position: fixed;
		  right: 10px;
		  bottom: 10px;
		  width: 60%;
		  height: 70%;
		  background-color: #f9f9f9;
		  border: 1px solid #ccc;
		  border-radius: 5px;
		  box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
		  z-index: 9999;
		  display: none;
		}
	
	#chat-header {
	  background-color: #333;
	  color: #fff;
	  font-weight:
      }
    </style>
  </head>
  <body>
  	<input id="id"><button id="connect-btn">connect</button><br>
  	<input id="receiver"><br>
  	<input id="message"><button id="message-send-btn">send</button><br>
  	<div id="content"></div>
    <div id="scroll-to-chat">&#x1F4AC;</div>
    <div id="chat-popup">
      <div id="chat-list"></div>
      <div id="chat-content"></div>
      <textarea id="chat-input" placeholder="메시지를 입력하세요..."></textarea>
    </div>

<script type="text/javascript" src="/js/jquery.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.1.5/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script>

var stompClient = null;

function connect(userId) {
    var socket = new SockJS('/stomp/chat?' + userId);
    stompClient = Stomp.over(socket);
    stompClient.connect({}, function (frame) {
        console.log('Connected: ' + frame);
        stompClient.subscribe('/direct/' + userId, function (message) {
        	$('#content').append('<div>' + message.senderId + ':' + message.message + '</div><br>');
        });
    });
}

function disconnect() {
    if (stompClient !== null) {
        stompClient.disconnect();
    }
    console.log("Disconnected");
}


$('#connect-btn').click(function (){
    if($('#connect-btn').text() === 'connect'){
        connect($('#id').val());
        $('#connect-btn').text('disconnect');
    } else if($('#connect-btn').text() === 'disconnect'){
        disconnect();
        $('#connect-btn').text('connect');
    }
});

$('#message-send-btn').click(function (){
    stompClient.send("/direct/" + $('#receiver').val(), {}, JSON.stringify({
            'receiverId': $('#receiver').val(),
            'senderId' : $('#id').val(),
            'message' : $('#message').val(),
            'chatDate' : Date.now()
        }));
});


</script>
</body>
</html>
        