<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="/common/layout/default-layout">

<!-- 페이지 제목 입력 -->
<th:block layout:fragment="title">
	<title>공지사항</title>
</th:block>

<!-- 현재 화면에서만 사용하는 css -->
<th:block layout:fragment="css">
	<style type="text/css">
		
		.container{
			margin: 0 auto;
			width: 1000px;
		}
		
		#notice-list-div {
			margin: 0 auto;
			width: 800px;
			height: 400px;
			
		}
		#notice-main{
			margin-left: 50px;
		}
		.notice{
		  display: inline-block;
		}
		.notice-no{
			width: 40px;
		}
		.notice-title{
			width: 540px;
			margin-right: 100px;
			overflow: hidden;
		}
		.notice-reg-date{
			width: 90px;
		}
		p {
			margin: 0 5px;
		}
		li{
			list-style: none;
		}
		ul {
			padding: 0px;
		}
		hr {
			margin: 2 0px;
		}
		.notice-page {
			display: inline-block;
			border: 1px solid #EAEAEA;
			width: 30px;
			height: 30px;
			cursor: pointer;
		}
		.notice-page, .notice-no, .notice-reg-date{
			text-align: center;
			line-height: 30px; /* 중간 높이로 해줌  */
		}
		#pager{
			text-align: center;
			margin-top: 30px;
		}
		#search-div{
			display: flex; 
			justify-content: flex-end;
			margin-right: 100px;
		}
		.notice-page{
			text-decoration: none;
			color: black;
		}
		.th-title{
			text-align: center;
		}
	</style>
		
	<!-- 채팅 기능이 필요없는 페이지는 아래 한줄 지워주세요  -->
	<th:block th:replace="/common/style/chat-css :: chatCssFragment"></th:block>
</th:block>

<div>
	<th:block layout:fragment="content">
	 <div class="container">
	<h2 id="notice-main">공지사항</h2>
	<div id="search-div">
		<input type="text" id="notice-search">
		<button id="notice-search-btn">검색</button>
	</div>
	<div id="notice-list-div">
	<table id="notice-list-table">
	</table>
	</div>
	<div id="pager">
	</div>
	</div> <!-- class="container" -->
		<!-- 채팅 기능이 필요없는 페이지는 아래 한줄 지워주세요  -->
		<th:block th:replace="/common/fragment/chat :: chatFragment"></th:block>
	</th:block>
</div>

<!-- 현재 화면에서만 사용하는 js -->
<th:block layout:fragment="script">
	<script type="text/javascript">
		// 뒤로가기 해쉬값 가져오기
		function checkForHash(){
			if(location.hash){
				// 한글 깨지지 않게 나오도록 처리
				var hash = decodeURI(location.hash);
				hash = hash.replace("#","");
				var arrCurrentPage_Search = hash.split(",");
				var currentPage = arrCurrentPage_Search[0];
				var search = arrCurrentPage_Search[1];
				noticeChange(search, currentPage);
			}else{
				noticeChange("", 1);
			} 
		};
		// 페이징, 검색 기능
		function noticeChange(search, currentPage){
			$.ajax({
				url : "/talent/notice/notices",
				type : "GET",
				data : {
						search : search, 
						currentPage : currentPage
				},
				dataType: 'json',
		          	success:function(data) {
		          		
		          		var noticeList = data.noticeList;
		          		var noticeListTable = $('#notice-list-table');

		             	// 기존 테이블 초기화
		    			noticeListTable.empty();

		    			// 테이블 헤더 생성
		    			var tableHeader = $('<tr></tr>');
		    			var headerNo = $('<th></th>').addClass('notice notice-no').text('번호');
		    			var headerTitle = $('<th></th>').addClass('notice notice-title th-title').text('제목');
		    			var headerRegDate = $('<th></th>').addClass('notice notice-reg-date').text('등록일');
		    			tableHeader.append(headerNo).append(headerTitle).append(headerRegDate);
		    			noticeListTable.append(tableHeader);

		    			// 받아온 데이터를 반복하며 리스트 아이템 생성
		    			$.each(noticeList, function(index, notice) {
		    				var tableRow = $('<tr></tr>').addClass('notice-detail').attr('data-noticeno', notice.noticeNo);
		    				var no = $('<td></td>').addClass('notice notice-no').text(notice.noticeNo);
		    				var title = $('<td></td>').addClass('notice notice-title').text(notice.title);
		    				var regDate = $('<td></td>').addClass('notice notice-reg-date').text(notice.regDate.substring(0, 10));

		    				tableRow.append(no).append(title).append(regDate);
		    				noticeListTable.append(tableRow);
		    			});
		    			
		                var pager = data.pager;
		                var startNum = parseInt(pager.startNum);
		                var lastNum = parseInt(pager.lastNum);
		                var pagerDiv = $('#pager');
		    			
		                // 기존 페이지 번호 삭제
		                pagerDiv.empty();
		                
		                var page = $('<a></a>').addClass('notice-page').text('<');
		                pagerDiv.append(page);
		                
		           	  	// 페이지 번호 생성
		                for (var i=startNum; i<=lastNum; i++) {
		                    var page = $('<a></a>').addClass('notice-page').text(i);
		    				if(pager.currentPage == i){
		    					page.css('background-color', '#EAEAEA');
		    				}
		                    pagerDiv.append(page);
		                }
		                pagerDiv.append($('<a></a>').addClass('notice-page').text('>'));
		           	  	
						$('#notice-search-btn').one('click', function(){
							noticeChange($('#notice-search').val(), 1);
						});
						$('.notice-page').one('click', function(){
							if($(this).text() === '<'){
								if(parseInt(pager.currentPage) != 1){
									noticeChange($('#notice-search').val(), parseInt(pager.currentPage) - 1);
								}
							}else if($(this).text() === '>'){
								if(parseInt(pager.currentPage) != parseInt(pager.totalPage)){
									noticeChange($('#notice-search').val(), parseInt(pager.currentPage) + 1);
								}
							}else{
								noticeChange($('#notice-search').val(), $(this).text());
							}
						});
						// 해쉬에값 저장
						hash = currentPage + "," + search;
						location.hash = hash;
						$('.notice-detail').on('click', function(){
							location.href = "/talent/notice/" + $(this).data('noticeno') + "/detail";							
						});
		          	}
			});
		}
		// 공지사항 페이지 로드
		$(function() {
			checkForHash();
		});
		// 공지사항 검색 입력란  EnterKey 입력 시 검색 기능
		$('#notice-search').on('keydown', function(value) {
			  if(value.keyCode == 13) {
				  $('#notice-search-btn').click();
			  }
		});
		
	</script>
	
		<!-- 채팅 기능이 필요없는 페이지는 아래 한줄 지워주세요  -->
	<th:block th:replace="/common/script/chat-js :: chatJsFragment"></th:block>
</th:block>
</html>