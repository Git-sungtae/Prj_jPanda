<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kakao.jPanda.yjh.CouponMapper">

	<insert id="insertCoupon" parameterType="Coupon">
		insert 
		into coupon 
		values (#{couponNo}, #{startDate}, #{endDate}, #{couponValue})
	</insert>
	
	<select id="findCouponList" resultType="Coupon">
		select *
		from coupon
	</select>
	
	<select id="selectCouponsExpired" resultType="Coupon">
	<![CDATA[
		select
            	count(cu.coupon_no) as usedcoupon_count,
            	c.coupon_no,
           	 	c.issue_date,
            	c.expire_date,
            	c.coupon_value
		from        
            	coupon c, coupon_use cu
		where
            	c.expire_date <= sysdate
		and 
            	c.coupon_no = cu.coupon_no
		group by 
            	c.coupon_no, c.issue_date, c.expire_date, c.coupon_value
	]]>
	</select>
</mapper>